<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
    <TargetFrameworks>netstandard2.1;net5.0</TargetFrameworks>
    <RazorLangVersion>3.0</RazorLangVersion>
    <GeneratePackageOnBuild>false</GeneratePackageOnBuild>
    <VersionPrefix>1.1.2</VersionPrefix>
    <VersionSuffix></VersionSuffix>
    <PackageLicenseFile></PackageLicenseFile>
    <Authors>Simon Ziegler of Dioptra and Mark Stega of Optimium Health</Authors>
    <Company>Material.Blazor</Company>
    <Description>A lightweight Material Theme component library for Blazor. Intended to adhere rigorously to Material Theme guidelines in https://material.io. API and other documentation can be found at https://material-blazor.com/docs.</Description>
    <RepositoryUrl>https://github.com/Material-Blazor/Material.Blazor</RepositoryUrl>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <PackageReleaseNotes></PackageReleaseNotes>
    <NeutralLanguage>en</NeutralLanguage>
    <Copyright>Dioptra and Optimium Health</Copyright>
    <PackageProjectUrl>https://material-blazor.com</PackageProjectUrl>
    <Product>Material.Blazor</Product>
    <UserSecretsId>d7509b6c-bc5c-4a56-a750-09c8ae4aeb85</UserSecretsId>

    <Configurations>Debug;Release</Configurations>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)'=='Debug'">
    <DefineConstants>Logging</DefineConstants>
    <!--<DefineConstants>Logging;LoggingVerbose</DefineConstants>-->
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)'=='Release'">
    <DefineConstants>NoLogging</DefineConstants>
  </PropertyGroup>

  <PropertyGroup>
    <DisableFastUpToDateCheck>true</DisableFastUpToDateCheck>
  </PropertyGroup>

  <ItemGroup>
    <SupportedPlatform Include="browser" />
  </ItemGroup>
  
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
    <WarningLevel>5</WarningLevel>
  </PropertyGroup>

  <ItemGroup>
    <Content Remove="package-lock.json" />
    <Content Remove="package.json" />
    <Content Remove="tsconfig.json" />
  </ItemGroup>

  <!-- Conditionally obtain references for the .NET Standard 2.1 target -->
  <ItemGroup Condition=" '$(TargetFramework)' == 'netstandard2.1' ">
    <PackageReference Include="Microsoft.AspNetCore.Components" Version="3.1.9" />
    <PackageReference Include="Microsoft.AspNetCore.Components.Web" Version="3.1.9" />
  </ItemGroup>

  <!-- Conditionally obtain references for the .NET Framework 5.0 target -->
  <ItemGroup Condition=" '$(TargetFramework)' == 'net5.0' ">
    <PackageReference Include="Microsoft.AspNetCore.Components" Version="5.0.0-rc.2.20475.17" />
    <PackageReference Include="Microsoft.AspNetCore.Components.Web" Version="5.0.0-rc.2.20475.17" />
    <PackageReference Include="System.Net.Http.Json" Version="5.0.0-rc.2.20475.5" />
  </ItemGroup>

  <ItemGroup>
    <None Include="package-lock.json" />
    <None Include="package.json" />
    <None Include="tsconfig.json" />
  </ItemGroup>

  <ItemGroup>
    <None Update="Scripts\MaterialBlazor.ts">
      <SubType>Code</SubType>
    </None>
  </ItemGroup>

  <ItemGroup>
    <InputStaticAssetsScripts Include="**\*.js;**\*.ts" Exclude="wwwroot\**\*;bin\**\*;node_modules\**\*;obj\**\*" />
    <OutputStaticAssetsScripts Include="wwwroot\bundled.min.js;wwwroot\unbundled.min.js;wwwroot\unbundled.js" />
  </ItemGroup>

  <ItemGroup>
    <InputStaticAssetsStyles Include="**\*.scss" Exclude="wwwroot\**\*;node_modules\**\*;obj\**\*;bin\**\*" />
    <OutputStaticAssetsStyles Include="wwwroot\bundled.min.css;wwwroot\unbundled.min.css;wwwroot\unbundled.css" />
  </ItemGroup>

  <Target Name="SetNpmReturnCodeUnconditionally" BeforeTargets="CheckIfNpmExists">
    <Exec Command="echo *****" ContinueOnError="true" StandardOutputImportance="low" StandardErrorImportance="low" LogStandardErrorAsError="false" IgnoreExitCode="true">
      <Output TaskParameter="ExitCode" PropertyName="NpmReturnCode" />
    </Exec>
  </Target>

  <Target Name="CheckIfNpmExists" Inputs="@(InputStaticAssetsScripts);@(InputStaticAssetsStyles)" Outputs="@(OutputStaticAssetsScripts);@(OutputStaticAssetsStyles)" BeforeTargets="PreBuildEvent">
    <Exec Command="echo ***** npm install" />
    <Exec Command="npm install" ContinueOnError="true" StandardOutputImportance="low" StandardErrorImportance="low" LogStandardErrorAsError="false" IgnoreExitCode="true">
      <Output TaskParameter="ExitCode" PropertyName="NpmReturnCode" />
    </Exec>
    <Exec Command="echo ***** 'npm install' return code was $(NpmReturnCode) (0 indicates npm is available)" />
  </Target>

  <Target Name="ErrorOutput" BeforeTargets="PreBuildEvent" AfterTargets="CheckIfNpmExists" Condition=" '$(NpmReturnCode)' != '0' ">
    <Exec Command="echo **********************************************************************************" />
    <Exec Command="echo **********************************************************************************" />
    <Exec Command="echo **********************************************************************************" />
    <Exec Command="echo CSS and JS not built due to the lack of a proper development environment" />
    <Exec Command="echo See https://material-blazor.com/docs/articles/DevelopmentEnvironment.html" />
    <Exec Command="echo **********************************************************************************" />
    <Exec Command="echo **********************************************************************************" />
    <Exec Command="echo **********************************************************************************" />
  </Target>

  <Target Name="BuildScripts" Inputs="@(InputStaticAssetsScripts)" Outputs="@(OutputStaticAssetsScripts)" BeforeTargets="PreBuildEvent" AfterTargets="CheckIfNpmExists" Condition=" '$(NpmReturnCode)' == '0' ">
    <Exec Command="echo ***** MakeDir wwwroot" />
    <MakeDir Directories="wwwroot" />

    <Exec Command="echo ***** npm run build-scripts" />
    <Exec Command="npm run build-scripts" />

    <Exec Command="echo ***** npm run build-js" />
    <Exec Command="npm run build-js" />

    <Exec Command="echo ***** npm run build-min-js" />
    <Exec Command="npm run build-min-js" />

    <Exec Command="echo ***** npm run build-min-bundle-js" />
    <Exec Command="npm run build-min-bundle-js" />

    <Exec Command="echo ***** delete materialblazor.js" />
    <Delete Files="wwwroot\materialblazor.js" />
  </Target>

  <Target Name="BuildStyles" Inputs="@(InputStaticAssetsStyles)" Outputs="@(OutputStaticAssetsStyles)" BeforeTargets="PreBuildEvent" AfterTargets="CheckIfNpmExists" Condition=" '$(NpmReturnCode)' == '0' ">
    <Exec Command="echo ***** mkdir wwwroot" />
    <MakeDir Directories="wwwroot" />

    <Exec Command="echo ***** downloadfile" />
    <DownloadFile SourceUrl="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" DestinationFolder="$(MSBuildProjectDirectory)\wwwroot" DestinationFilename="material-components-icons.css">
    </DownloadFile>

    <Exec Command="echo ***** npm run build-css" />
    <Exec Command="npm run build-css" />

    <Exec Command="echo ***** npm run build-min-css" />
    <Exec Command="npm run build-min-css" />

    <Exec Command="echo ***** npm run build-min-bundle-css" />
    <Exec Command="npm run build-min-bundle-css" />

  </Target>

  <ProjectExtensions>
    <VisualStudio>
      <UserProperties />
    </VisualStudio>
  </ProjectExtensions>

</Project>
